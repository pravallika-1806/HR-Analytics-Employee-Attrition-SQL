CREATE DATABASE IF NOT EXISTS hr_analytics;
USE hr_analytics;

CREATE TABLE employee_attrition (
    EmployeeNumber INT PRIMARY KEY,
    Age INT,
    Gender VARCHAR(10),
    Department VARCHAR(50),
    JobRole VARCHAR(50),
    MonthlyIncome INT,
    YearsAtCompany INT,
    JobSatisfaction INT,
    PerformanceRating INT,
    Attrition VARCHAR(5)
);

LOAD DATA INFILE 
'C:/ProgramData/MySQL/MySQL Server 8.0/Uploads/employee_attrition.csv'
INTO TABLE employee_attrition
FIELDS TERMINATED BY ','
ENCLOSED BY '"'
LINES TERMINATED BY '\n'
IGNORE 1 ROWS
(EmployeeNumber, Age, Gender, Department, JobRole,
 MonthlyIncome, YearsAtCompany, JobSatisfaction,
 PerformanceRating, Attrition);

SELECT COUNT(*) AS total_records FROM employee_attrition;
SELECT * FROM employee_attrition LIMIT 10;

SELECT 
    COUNT(*) AS total_employees,
    SUM(CASE WHEN Attrition = 'Yes' THEN 1 ELSE 0 END) AS attrition_count,
    ROUND(
        SUM(CASE WHEN Attrition = 'Yes' THEN 1 ELSE 0 END) 
        / COUNT(*) * 100, 2
    ) AS attrition_rate_percentage
FROM employee_attrition;

SELECT 
    Department,
    COUNT(*) AS total_employees,
    SUM(CASE WHEN Attrition = 'Yes' THEN 1 ELSE 0 END) AS attrition_count
FROM employee_attrition
GROUP BY Department
ORDER BY attrition_count DESC;

SELECT 
    JobRole,
    COUNT(*) AS total_employees,
    SUM(CASE WHEN Attrition = 'Yes' THEN 1 ELSE 0 END) AS attrition_count
FROM employee_attrition
GROUP BY JobRole
ORDER BY attrition_count DESC;

SELECT 
    Attrition,
    ROUND(AVG(MonthlyIncome), 2) AS avg_monthly_income
FROM employee_attrition
GROUP BY Attrition;

SELECT 
    YearsAtCompany,
    COUNT(*) AS total_employees,
    SUM(CASE WHEN Attrition = 'Yes' THEN 1 ELSE 0 END) AS attrition_count
FROM employee_attrition
GROUP BY YearsAtCompany
ORDER BY YearsAtCompany;

SELECT 
    JobSatisfaction,
    COUNT(*) AS total_employees,
    SUM(CASE WHEN Attrition = 'Yes' THEN 1 ELSE 0 END) AS attrition_count
FROM employee_attrition
GROUP BY JobSatisfaction
ORDER BY JobSatisfaction;


SELECT 
    Gender,
    COUNT(*) AS total_employees,
    SUM(CASE WHEN Attrition = 'Yes' THEN 1 ELSE 0 END) AS attrition_count
FROM employee_attrition
GROUP BY Gender;


SELECT 
    EmployeeNumber,
    Department,
    JobRole,
    MonthlyIncome,
    YearsAtCompany,
    JobSatisfaction
FROM employee_attrition
WHERE Attrition = 'Yes'
  AND JobSatisfaction <= 2
  AND YearsAtCompany <= 3;


SELECT 
    Department,
    COUNT(*) AS attrition_count,
    RANK() OVER (ORDER BY COUNT(*) DESC) AS attrition_rank
FROM employee_attrition
WHERE Attrition = 'Yes'
GROUP BY Department;
